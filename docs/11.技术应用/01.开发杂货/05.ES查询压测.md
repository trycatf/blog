---
title: ES查询压测
date: 2022-04-29 18:31:15
permalink: /pages/6e6e98/
categories:
  - 技术应用
  - 工作杂货
tags:
  - ES
author: 
  name: luoxiaofeng
  link: https://github.com/954118124
---
## 1 概述

测试ES在各个数据体量下,单号查询,时间范围查询的性能指标。

## 2 测试环境及工具

| 数据库        | 版本  | 硬件           | 测试工具 |
| :------------ | :---- | :------------- | :------- |
| Elasticsearch | 6.8.1 | 32核48G内存3台 | Jmeter   |

<!-- more -->

## 3 测试类型

### 3.1 按单号查询-6字段

| 查询类型 | 数据量 | 总数据大小 | 平均响应时间（ms） | 吞吐量（/sec） |
| :------- | :----- | :--------- | :----------------- | :------------- |
| 单号查询 | 5000万 | 5.7 GB     | 3.63               | 4925.3         |
|          | 1亿    | 11.3 GB    | 4.7                | 4909.18        |
|          | 2亿    | 22.5 GB    | 15.74              | 3443.13        |
|          | 4亿    | 44.9 GB    | 40.11              | 1869.74        |
|          | 8亿    | 89.1 GB    | 73.51              | 1172.52        |
|          | 10亿   | 111.6 GB   | 84.37              | 1035.8         |

**Jmeter测试结果截图如下:**

5千万数据量-单号查询

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429180834463.png" class="imgcss" width="70%">  

4亿数据量-单号查询

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429181009431.png" class="imgcss" width="70%"> 

10亿数据量-单号查询

 <img src="http://media.luoxiaofeng.cn/blog/img/image-20220429181045011.png" class="imgcss" width="70%"> 



#### 3.1.1 按单号查询-145字段

| 查询类型 | 字段数 | 数据量 | 总数据大小 | 平均响应时间（ms） | 吞吐量（/sec） |
| :------- | :----- | :----- | :--------- | :----------------- | :------------- |
| 单号查询 | 145    | 10亿   | 1.4 TB     | 214.18             | 437.11         |

**Jmeter测试结果截图如下:**

  <img src="http://media.luoxiaofeng.cn/blog/img/image-20220429181333786.png" class="imgcss" width="70%"> 

 

### 3.2 按时间范围查询-6字段

| 查询类型         | 数据量 | 总数据大小 | 平均响应时间(ms) | 吞吐量(/sec) |
| :--------------- | :----- | :--------- | :--------------- | :----------- |
| 时间范围查询-7天 | 5000万 | 5.7 GB     | 40.45            | 1748.35      |
|                  | 1亿    | 11.3 GB    | 64.48            | 1260.98      |
|                  | 2亿    | 22.5 GB    | 177.99           | 511.58       |
|                  | 4亿    | 44.9 GB    | 346.39           | 275          |
|                  | 8亿    | 89.1 GB    | 702.22           | 138.98       |
|                  | 10亿   | 111.6 GB   | 757.83           | 129.06       |

**Jmeter测试结果截图如下:**

5千万数据量-时间范围查询

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429181906325.png" class="imgcss" width="70%"> 

4亿数据量-时间范围查询

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429181939539.png" class="imgcss" width="70%"> 

10亿数据量-时间范围查询

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429182125640.png" class="imgcss" width="70%"> 

 

#### 3.2.1 按时间范围查询-145字段 

| 查询类型       | 字段数 | 数据量 | 总数据大小 | 平均响应时间（****ms****） | 吞吐量（****/sec****） |
| :------------- | :----- | ------ | :--------- | :------------------------- | :--------------------- |
| 按范围查询-7天 | 145    | 10亿   | 1.4T       | 645.54                     | 151.68                 |

**Jmeter测试结果截图如下:**

<img src="http://media.luoxiaofeng.cn/blog/img/image-20220429182240368.png" class="imgcss" width="70%"> 

 

## 4 测试结果与分析

1. 字段数对精确查询性能影响较大，范围查询没有明显影响

2. 数据量对精确查询和范围查询均有较大影响